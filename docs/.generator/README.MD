# Martyrs Documentation Generator

Интеллектуальный генератор документации для фреймворка martyrs и проектов, использующих этот фреймворк. Использует OpenAI ChatGPT API для анализа кода и формирования понятной документации в формате Markdown с поддержкой контекстного обучения и памяти.

## Особенности

- **Контекстное обучение**: Использует сгенерированную документацию для улучшения последующих генераций
- **Система памяти**: Хранит и индексирует сгенерированную документацию для создания контекста
- **Умные связи разделов**: Анализирует связи между разделами для обеспечения согласованности
- **Инкрементальная генерация**: Анализирует и документирует только новые или изменённые файлы
- **Глобальная структура документации**: Сначала создаёт структуру документации, а потом её наполняет
- **Метрики покрытия**: Отслеживает процент покрытия кодовой базы документацией
- **Импорт существующей документации**: Поддерживает загрузку и анализ готовых файлов документации
- **Оптимизация токенов**: Эффективно использует токены API при работе с большими проектами

## Процесс работы
1. **Сканирование проекта**: Находит все JS, Vue, SCSS, CSS и JSON файлы
2. **Анализ файлов**: Использует ChatGPT для понимания назначения каждого файла
3. **Создание TOC**: Генерирует глобальную структуру документации на основе анализа
4. **Построение контекстной памяти**: Импортирует и анализирует существующую документацию
5. **Генерация контента**: Создает документацию с использованием контекстной информации
6. **Сохранение генераций**: Индексирует сгенерированные фрагменты для будущего использования
7. **Извлечение концепций**: Распознает ключевые концепции и связи в документации

## Требования

- Node.js 14+
- Ключ API OpenAI
- NPM для управления зависимостями

## Установка

1. Клонируйте репозиторий:
```bash
git clone <url-репозитория>
cd martyrs-doc-generator
```

2. Установите зависимости:
```bash
pnpm install
```

3. Создайте файл `.env` на основе примера:
```bash
cp .env.example .env
```

4. Отредактируйте `.env` и добавьте ваш ключ API OpenAI:
```
OPENAI_API_KEY=ваш-ключ-api-openai
```

## Использование

### Базовые команды

```bash
# Генерация документации (инкрементальный режим с использованием контекстной памяти)
pnpm start

# Полный сброс и регенерация документации
pnpm run reset

# Импорт существующей документации
pnpm run import -- --import-docs ./path/to/docs

# Просмотр текущего статуса документации
pnpm run status

# Статистика контекстной памяти
pnpm run memory-stats

# Очистка контекстной памяти
pnpm run clear-memory
```

### CLI-интерфейс

Вы можете также использовать глобальную команду после установки:

```bash
# Глобальная установка
pnpm install -g .

# Базовая генерация
martyrs-doc

# Сброс и регенерация
martyrs-doc reset

# Импорт существующей документации
martyrs-doc import --import-docs ./path/to/docs

# Просмотр статуса
martyrs-doc status

# Статистика памяти документации
martyrs-doc memory-stats

# Очистка памяти
martyrs-doc clear-memory

# Справка
martyrs-doc help
```

## Конфигурация контекстного обучения

Настройки контекстной памяти и обучения можно изменить через переменные окружения или файл `.env`:

| Переменная | Описание | Значение по умолчанию |
|------------|----------|----------------------|
| USE_MEMORY_FOR_CONTEXT | Использование памяти для контекста | true |
| EXISTING_DOCS_PATH | Путь к существующим файлам документации | null |
| MAX_CONTEXT_TOKENS | Максимальное количество токенов для контекста | 4000 |
| MAX_NEW_TOKENS | Максимальное количество токенов для генерации | 1500 |
| MIN_TOKENS_FOR_SUMMARY | Мин. кол-во токенов для суммирования | 1000 |
| MAX_RELATED_DOCUMENTS | Макс. кол-во связанных документов | 3 |
| USE_SYSTEM_PROMPT | Использовать системный промпт | true |
| USE_CONTINUATION | Использовать продолжение для больших промптов | true |

## Структура проекта

```
doc-generator/
├── index.js                # Главная точка входа
├── fileScanner.js          # Сканирование файлов проекта
├── analyzer.js             # Анализ файлов с помощью ChatGPT
├── stateManager.js         # Управление состоянием и кэшированием 
├── documentMemoryManager.js # Управление контекстной памятью
├── contextOptimizer.js     # Оптимизация контекста для API
├── tocGenerator.js         # Генерация оглавления документации
├── documentationBuilder.js # Создание содержимого документации
├── utils.js                # Утилиты для работы с токенами и файлами
├── config.js               # Конфигурация генератора
├── logger.js               # Система логирования
├── bin/                    # CLI-интерфейс
│   └── martyrs-doc.js      # Скрипт командной строки
└── scripts/                # Вспомогательные скрипты
    └── docStatus.js        # Проверка статуса документации
```

## Система контекстной памяти

Генератор использует продвинутую систему контекстной памяти для улучшения качества документации:

1. **Индексирование документации**: Каждый сгенерированный раздел сохраняется и индексируется
2. **Извлечение концепций**: Из документации извлекаются ключевые концепции и термины
3. **Построение связей**: Создаются связи между разделами на основе общих концепций
4. **Контекстные запросы**: При генерации нового раздела используются релевантные части существующей документации
5. **Суммирование контекста**: Большие фрагменты документации суммируются для эффективного использования токенов
6. **Продолжение генерации**: Для больших разделов используется механизм продолжения с сохранением контекста

## Импорт существующей документации

Вы можете импортировать существующие файлы документации в систему контекстной памяти:

```bash
martyrs-doc import --import-docs ./path/to/docs
```

Поддерживаются следующие форматы:
- Markdown (`.md`)
- JavaScript с JSDoc комментариями (`.js`)
- Текстовые файлы (`.txt`)

## Метрики и статистика

Генератор предоставляет подробную статистику о документации и памяти:

```bash
martyrs-doc status        # Общая статистика
martyrs-doc memory-stats  # Статистика контекстной памяти
```

Статистика включает:
- Покрытие документацией (общее, фреймворк, проект)
- Количество завершенных разделов
- Документы в контекстной памяти
- Извлеченные концепции и термины
- Связи между разделами документации

## Лицензия

MIT