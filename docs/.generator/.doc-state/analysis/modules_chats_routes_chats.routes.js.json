{
  "path": "../../src/modules/chats/routes/chats.routes.js",
  "relativePath": "modules/chats/routes/chats.routes.js",
  "type": "source",
  "name": "chats.routes.js",
  "extension": ".js",
  "analysis": {
    "Summary": "Файл регистрирует в приложении маршруты REST и WebSocket-обработчики для модуля чата: присоединение к чату, отправка и получение сообщений, а также устанавливает базовые CORS-заголовки.",
    "Purpose": "Настроить в основном сервере все точки входа и события WebSocket для работы с чатами: хранение и рассылку сообщений, получение истории переписки.",
    "Components": [
      {
        "name": "controller",
        "type": "object",
        "responsibility": "Инкапсулирует логику сохранения и выборки сообщений из БД; создаётся через controllerFactory(db)."
      },
      {
        "name": "verifySignUp",
        "type": "function",
        "responsibility": "Middleware для проверки данных при регистрации (импортируется, но в данном файле не используется)."
      },
      {
        "name": "verifyUser",
        "type": "function",
        "responsibility": "Middleware для проверки авторизации пользователя (импортируется, но в данном файле не используется)."
      }
    ],
    "Functions": [
      {
        "name": "defaultExport",
        "params": [
          "app",
          "db",
          "wss"
        ],
        "description": "Регистрация WebSocket-модуля 'chat', HTTP-маршрутов и глобального CORS-middleware."
      },
      {
        "name": "WebSocketHandler",
        "params": [
          "ws",
          "msg"
        ],
        "description": "Обрабатывает события типа 'joinChat' (подписка на чат) и 'message' (сохранение сообщения и широковещательная рассылка только участникам чата)."
      },
      {
        "name": "GET /messages/:chatId",
        "params": [
          "req",
          "res"
        ],
        "description": "Возвращает историю сообщений для указанного chatId, используя метод controller.getMessages."
      },
      {
        "name": "CORS Middleware",
        "params": [
          "req",
          "res",
          "next"
        ],
        "description": "Добавляет заголовки Access-Control-Allow-* ко всем ответам."
      }
    ],
    "Dependencies": [
      "@martyrs/src/modules/auth/controllers/middlewares/index.js",
      "../controllers/chats.controller.js"
    ],
    "Usage": "Импортируется в основном файле запуска сервера и вызывается как функция: chatsRoutes(app, db, wss), что автоматически настраивает все маршруты и WS-обработчики чата.",
    "Importance": 4,
    "Notes": [
      "Middleware verifySignUp и verifyUser импортированы, но не применяются — возможно, планировалось добавить защищённые маршруты.",
      "Используется свойство ws.activeChats (Set) для фильтрации подписанных клиентов при рассылке сообщений.",
      "wss.broadcastToModuleWithFilter позволяет отправлять сообщения только тем клиентам, у которых есть соответствующий chatId в activeChats."
    ]
  }
}