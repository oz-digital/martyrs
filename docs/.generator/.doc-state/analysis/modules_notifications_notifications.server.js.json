{
  "path": "../../src/modules/notifications/notifications.server.js",
  "relativePath": "modules/notifications/notifications.server.js",
  "type": "source",
  "name": "notifications.server.js",
  "extension": ".js",
  "analysis": {
    "Summary": "Файл инициализирует подсистему уведомлений: регистрирует модели в базе данных, настраивает маршруты HTTP/WebSocket, запускает сервис обработки уведомлений и планировщик фоновых задач.",
    "Purpose": "Основная задача — собрать воедино все компоненты модуля уведомлений (модели, контроллеры, маршруты, сервис) и инициализировать их при старте приложения.",
    "Components": [
      {
        "name": "NotificationModel",
        "responsibility": "Определение схемы и методов работы с уведомлениями в БД."
      },
      {
        "name": "UserDeviceModel",
        "responsibility": "Модель для хранения устройств пользователей, на которые будут отправляться уведомления."
      },
      {
        "name": "NotificationPreferenceModel",
        "responsibility": "Модель предпочтений уведомлений каждого пользователя."
      },
      {
        "name": "NotificationLogModel",
        "responsibility": "Модель логирования фактов отправки/получения уведомлений."
      },
      {
        "name": "NotificationsController",
        "responsibility": "Контроллер HTTP-эндпойнтов для работы с уведомлениями."
      },
      {
        "name": "NotificationService",
        "responsibility": "Сервис бизнес-логики: генерация, отправка и обработка очереди уведомлений."
      }
    ],
    "Functions": [
      {
        "name": "initializeNotifications",
        "description": "Главная функция инициализации модуля уведомлений.",
        "parameters": {
          "app": "Express-приложение (или аналог) для регистрации HTTP-маршрутов.",
          "db": "Объект подключения к базе данных, куда регистрируются модели.",
          "wss": "WebSocket Server для пуш-уведомлений в реальном времени.",
          "origins": "Массив или строка допустимых Origin для WebSocket.",
          "publicPath": "Путь к статическим ресурсам (если требуется для маршрутов)."
        }
      }
    ],
    "Dependencies": [
      "@martyrs/src/modules/globals/controllers/classes/globals.abac.js",
      "./controllers/notifications.controller.js",
      "./models/notification-log.model.js",
      "./models/notification-preference.model.js",
      "./models/notification.model.js",
      "./models/user-device.model.js",
      "./routes/notifications.routes.js",
      "./services/notification.service.js"
    ],
    "Usage": "Импортируется модулем верхнего уровня (например, в файле инициализации приложения) и вызывается метод initialize(app, db, wss, origins, publicPath). Также доступен через default-экспорт для удобства.",
    "Importance": 4,
    "Notes": [
      "Использует ABAC (политики доступа) через globalsabac.getInstance(db).",
      "Запускает фоновый планировщик (setInterval) для обработки очереди уведомлений каждую минуту.",
      "Закомментирована часть инициализации политик уведомлений (initNotificationPolicies).",
      "Есть отладочный console.log для WebSocket-сервера."
    ]
  }
}