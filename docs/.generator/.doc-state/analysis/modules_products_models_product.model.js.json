{
  "path": "../../src/modules/products/models/product.model.js",
  "relativePath": "modules/products/models/product.model.js",
  "type": "source",
  "name": "product.model.js",
  "extension": ".js",
  "analysis": {
    "summary": "This file defines and exports a Mongoose model for the 'Product' entity, including its schema, indexes, plugins and sub-documents (like discounts).",
    "purpose": "Provide a reusable, fully configured Mongoose model for products in the application, incorporating common fields, ownership metadata, and discount sub-documents.",
    "components": [
      {
        "name": "DiscountSchema",
        "type": "Mongoose Schema",
        "responsibility": "Defines the sub-document schema for individual discounts on a product (imported from './schemas/discount.schema.js')."
      },
      {
        "name": "ProductSchema",
        "type": "Mongoose Schema",
        "responsibility": "Describes the structure of the Product collection: fields (listing, sku, category refs, variants refs, images, name, description, attributes, translations), discount sub-documents, timestamps, and indexes."
      },
      {
        "name": "Product",
        "type": "Mongoose Model",
        "responsibility": "The compiled Mongoose model, ready for CRUD operations elsewhere in the codebase."
      }
    ],
    "functions": [
      {
        "name": "default export",
        "signature": "(db) => Model",
        "purpose": "Factory function that takes a database object (with mongoose) and returns a configured Product model.",
        "parameters": [
          {
            "name": "db",
            "type": "Object",
            "description": "An object exposing mongoose and connection details."
          }
        ],
        "returns": "Mongoose.Model('Product')"
      }
    ],
    "dependencies": [
      {
        "module": "@martyrs/src/modules/globals/models/schemas/common.schema.js",
        "imported": "applyCommonSchema",
        "purpose": "Adds common fields (e.g., timestamps, status flags) to the schema."
      },
      {
        "module": "@martyrs/src/modules/globals/models/schemas/ownership.schema.js",
        "imported": "applyOwnershipSchema",
        "purpose": "Adds ownership metadata (e.g., createdBy, updatedBy) to the schema."
      },
      {
        "module": "./schemas/discount.schema.js",
        "imported": "discountschema",
        "purpose": "Factory for the Discount sub-schema."
      },
      {
        "module": "db.mongoose",
        "imported": "Schema, model",
        "purpose": "Mongoose core for defining schemas and models."
      }
    ],
    "usage": "Imported during application startup (e.g., in a model index or loader). Called with the `db` context to register the `Product` model on the Mongoose connection so it can be injected into services or controllers.",
    "importance": 4,
    "notes": [
      "Applies two indexes: a single-field index on `category` and a text index on `name` + `description` for search functionality.",
      "Timestamps are customized to use `Date.now()` via `currentTime`.",
      "Ownership and common schemas are applied as plugins to standardize fields across all models.",
      "Discounts are embedded sub-documents rather than separate collections, optimizing lookup for typical product+discount workflows."
    ]
  }
}