{
  "path": "../../src/modules/notifications/models/user-device.model.js",
  "relativePath": "modules/notifications/models/user-device.model.js",
  "type": "source",
  "name": "user-device.model.js",
  "extension": ".js",
  "analysis": {
    "Summary": "Этот файл экспортирует функцию, которая определяет и регистрирует Mongoose-модель UserDevice для хранения информации об устройстве пользователя (push-токены, типы устройств и статус активности).",
    "Purpose": "Обеспечить в проекте схему и модель для работы с данными об устройствах пользователя в контексте рассылок уведомлений.",
    "Components": [
      {
        "name": "schema",
        "type": "mongoose.Schema",
        "responsibilities": [
          "Определяет поля документа UserDevice: userId, deviceId, deviceType, deviceToken, isActive, lastActive",
          "Настраивает уникальный композитный индекс по полям userId + deviceId"
        ]
      }
    ],
    "Functions": [
      {
        "name": "default export",
        "description": "Функция, принимающая объект db (с подключённым mongoose) и дополнительные поля, создаёт и возвращает модель UserDevice.",
        "parameters": [
          {
            "name": "db",
            "type": "Object",
            "description": "Контекст базы данных с подключением mongoose"
          },
          {
            "name": "additionalFields",
            "type": "Object",
            "description": "Дополнительные поля или настройки для схемы (по умолчанию пустой объект). В текущей реализации не используется."
          }
        ],
        "returns": {
          "type": "Model",
          "description": "Mongoose-модель UserDevice"
        }
      }
    ],
    "Dependencies": [
      "db.mongoose — подключённый mongoose-экземпляр",
      "mongoose.Schema.Types.ObjectId — тип для поля userId",
      "ref 'User' — ссылка на модель User"
    ],
    "Usage": "Импортировать и инициализировать модель, передав в неё контекст БД:\n\nconst defineUserDevice = require('modules/notifications/models/user-device.model').default;\nconst UserDevice = defineUserDevice(db);\n\nПосле этого использовать UserDevice в сервисах/контроллерах для CRUD-операций.",
    "Importance": 3,
    "Notes": [
      "Параметр additionalFields зарезервирован для расширения схемы, но в текущей версии не применяется.",
      "Композитный уникальный индекс ({ userId:1, deviceId:1 }) предотвращает дублирование записей одного и того же устройства.",
      "Поле deviceType ограничено тремя значениями: 'ios', 'android', 'web'."
    ]
  }
}